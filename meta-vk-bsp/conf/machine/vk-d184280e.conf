#@TYPE: Machine
#@NAME: Vekatech VK-D184280E machine
#@DESCRIPTION: RZ/G2LC platform

require conf/machine/include/rzg2l-family.inc
require conf/machine/include/arm/armv8-2a/tune-cortexa55.inc
require conf/machine/include/rz-common.inc

# Trusted Firmware-A configuration
PREFERRED_VERSION_trusted-firmware-a ?= "2.9%"
TFA_PLATFORM ?= "g2l"
TFA_BOARD ?= "vkcmg2lc"
TFA_UBOOT ?= "1"
TFA_BUILD_TARGET ?= "bl2 bl31"
BL2_BOOT_TARGET ?= "emmc"
TFA_SPI_FLASH ?= "MX25L51245G"

BL2_ADJUST_VMA ?= "0x00011E00"
FIP_ADJUST_VMA ?= "0x0000"


UBOOT_CONFIG ??= "emmc"
UBOOT_CONFIG[emmc] = "vk-d184280e-emmc_defconfig"

PREFERRED_VERSION_u-boot = "2021.10%"

UENV_FILE ?= "uEnv-vk-d184280e.txt"

# Flash Writer configuration
FLASH_WRITER_BOARD ?= "VKCMG2LC"

# Support board with PMIC. Default:yes.
# With this option enabled, build both bin files for PMIC board and Concrete board.
VKBOARD_SUPPORT ?= "1"
CONFIG_WKS_eMMC ?= "1"

# Supported devicetree
KERNEL_DTS = " \
	vk-d184280e/vk-d184280e.dts \
"

KERNEL_DEVICETREE = ""

KERNEL_DEVICETREE_OVERLAY  = " \
    vk-d184280e/overlays/vko-can.dts \
    vk-d184280e/overlays/vko-cm33.dts \
	vk-d184280e/overlays/vko-i2c2.dts \
	vk-d184280e/overlays/vko-qspi-mx25l51245g.dts \
	vk-d184280e/overlays/vko-rs485.dts \
	vk-d184280e/overlays/vko-udma.dts \
"

BSP_SOC = "RZG2LC"
BSP_BOARD = "VK-D184280E/G2LC-v2.0"

# Wic image
WKS_FILE = " ${@oe.utils.conditional("CONFIG_WKS_eMMC", "1", "image-vkboard-mmc.wks", "image-vkrboard-esd.wks", d)} "


IMAGE_BOOT_FILES = " \
	bl2_bp_emmc-${MACHINE}.bin \
	fip_emmc-${MACHINE}.bin \
	bl2_bp_emmc-${MACHINE}.srec \
	fip_emmc-${MACHINE}.srec \
	Flash_Writer_SCIF_VKCMG2LC_DDR4_2GB_1PCS.mot \
"

# Deploy the uEnv.txt to the /boot directory
WKS_FILE_DEPENDS:append = " uenv"
IMAGE_BOOT_FILES += " uEnv.txt"
IMAGE_BOOT_FILES += " readme.txt"

IMAGE_BOOT_FILES += " ${KERNEL_IMAGETYPE}  vk-d184280e.dtb "

# Support DTB Overlay files
IMAGE_BOOT_FILES += " overlays/*;overlays/"
#IMAGE_BOOT_FILES += " cm33/*;cm33/"

#IMAGE_FSTYPES += " wic "
IMAGE_FSTYPES:remove = "tar.gz tar.bz2 wic.gz wic.bz2"
IMAGE_FSTYPES:append = " tar.xz wic wic.xz wic.bmap"

do_image_wic[depends] += "firmware-pack:do_deploy flash-writer:do_deploy"

MACHINE_FEATURES:append = " mali-g31 "

MACHINE_EXTRA_RRECOMMENDS:append = " kernel-modules"
